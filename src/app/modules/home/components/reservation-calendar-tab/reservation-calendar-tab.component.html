<main>
  <mat-card>
    <mat-card-content>
      <app-resource-selection-form></app-resource-selection-form>
    </mat-card-content>
  </mat-card>

  <mat-card>
    <mat-card-content>
      <div class="calendar">
        <header class="calendar__header">
          <section class="calendar__navigation">
            <div class="calendar__options-left">
              <app-calendar-view-selection
                *ngIf="
                  (tabletSizeHit$ | async)?.matches === false;
                  else jumpToDate
                "
                [selectedView]="calendar.view"
                [tabletSizeHit$]="tabletSizeHit$"
                (viewSelected)="calendar.view = $event"
              ></app-calendar-view-selection>

              <button
                (click)="refetchInterval()"
                mat-button
                type="button"
                aria-labelledby="refresh-button-name"
                class="calendar__refresh"
                *ngIf="
                  (tabletSizeHit$ | async)?.matches === false;
                  else iconOnlyRefresh
                "
              >
                <mat-icon>refresh</mat-icon>&nbsp;<span
                  i18n="button name"
                  id="refresh-button-name"
                  >Refresh</span
                >
              </button>

              <ng-template #iconOnlyRefresh>
                <button
                  mat-icon-button
                  type="button"
                  aria-label="Refresh"
                  i18n-aria-label="button name"
                  class="calendar__refresh"
                >
                  <mat-icon>refresh</mat-icon>
                </button>
              </ng-template>

              <form class="calendar__options" [formGroup]="filterGroup">
                <mat-checkbox
                  color="primary"
                  formControlName="highlightMine"
                  class="calendar__highlight-mine"
                  i18n="checkbox name"
                  >Highlight mine</mat-checkbox
                >
              </form>
            </div>

            <ng-template #jumpToDate>
              <div>
                <button
                  mat-button
                  (click)="picker.open()"
                  class="calendar__datepicker"
                >
                  <mat-icon>event</mat-icon>&nbsp;Jump to date
                </button>
                <input
                  type="date"
                  class="calendar__datepicker-input"
                  [matDatepicker]="picker"
                  (dateInput)="onDateSelection($event.value)"
                />
                <mat-datepicker #picker></mat-datepicker>
              </div>
            </ng-template>

            <h1 class="calendar__view-date">
              {{
                calendar.viewDate | calendarDate : calendar.view + 'ViewTitle'
              }}
            </h1>

            <app-calendar-paginator
              class="calendar__paginator"
              [view]="calendar.view"
              [viewDate]="calendar.viewDate"
              (viewDateChange)="calendar.viewDate = $event"
            ></app-calendar-paginator>
          </section>
        </header>

        <shongo-calendar
          #calendar
          (loadData)="onIntervalChange($event)"
          [items]="(calendarRequest$ | async)!.data"
          [loading]="
            (calendarRequest$ | async)!.state === ERequestState.LOADING
          "
          [currentUser]="currentUser"
          [highlightUsersReservations]="!!filterGroup.value.highlightMine"
        ></shongo-calendar>
      </div>
    </mat-card-content>
  </mat-card>
</main>
